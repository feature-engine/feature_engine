[tox]
envlist =
    py39
    py310
    py311-sklearn150
    py311-sklearn160
    py311-sklearn170
    py311-pandas230
    py312
    py313
    codecov
    docs
    stylechecks
    typechecks
skipsdist = true


[testenv]
envdir = {toxworkdir}/unit_tests
install_command = pip install {opts} {packages}

setenv =
    PYTHONPATH = .
    COVERAGE_RCFILE = {envtmpdir}/coveragerc

commands =
    pytest tests


# -------------------------
# Python versions
# -------------------------

[testenv:py39]
deps =
    .[tests]

[testenv:py310]
deps =
    .[tests]

[testenv:py312]
deps =
    .[tests]

[testenv:py313]
deps =
    .[tests]


# -------------------------
# scikit-learn matrix
# -------------------------

[testenv:py311-sklearn150]
deps =
    .[tests]
    scikit-learn==1.5.1

[testenv:py311-sklearn160]
deps =
    .[tests]
    scikit-learn==1.6.1

[testenv:py311-sklearn170]
deps =
    .[tests]
    scikit-learn==1.7.1


[testenv:py311-pandas230]
deps =
    .[tests]
    pandas==2.3.0


# -------------------------
# Coverage
# -------------------------

[testenv:codecov]
deps =
    .[tests]

commands_pre =
    {envpython} -c 'from pathlib import Path; Path(r"{env:COVERAGE_RCFILE}").write_text(Path(".coveragerc").read_text())'

commands =
    coverage run -m pytest -v
    coverage report


# -------------------------
# Docs
# -------------------------

[testenv:docs]
deps =
    .[docs]

commands =
    sphinx-build -W -b html -d {envtmpdir}/doctrees docs {envtmpdir}/html


# -------------------------
# Linting & typing
# -------------------------

[testenv:stylechecks]
deps =
    flake8

commands =
    {posargs:flake8 feature_engine tests}

[testenv:typechecks]
deps =
    mypy

commands =
    {posargs:mypy feature_engine}


# -------------------------
# flake8 configuration
# -------------------------

[flake8]
exclude =
    .git
    env

# Match Black
max-line-length = 88

profile = black
line_length = 88
lines_between_sections = 1
known_first_party = sentry
